var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},n={},o=e.parcelRequiree764;null==o&&((o=function(e){if(e in t)return t[e].exports;if(e in n){var o=n[e];delete n[e];var i={id:e,exports:{}};return t[e]=i,o.call(i.exports,i,i.exports),i.exports}var c=new Error("Cannot find module '"+e+"'");throw c.code="MODULE_NOT_FOUND",c}).register=function(e,t){n[e]=t},e.parcelRequiree764=o);var i=o("idVGl"),c=o("c04jy"),r=(o("1CMLe"),o("jOfNW"));const s=[{name:"-",pos:i.V.vec(0,0),width:4,height:1,points:[i.V.vec(0,0),i.V.vec(1,0),i.V.vec(2,0),i.V.vec(3,0)]},{name:"+",pos:i.V.vec(0,0),width:3,height:3,points:[i.V.vec(1,0),i.V.vec(0,-1),i.V.vec(1,-1),i.V.vec(2,-1),i.V.vec(1,-2)]},{name:"L",pos:i.V.vec(0,0),width:3,height:3,points:[i.V.vec(2,0),i.V.vec(2,-1),i.V.vec(0,-2),i.V.vec(1,-2),i.V.vec(2,-2)]},{name:"I",pos:i.V.vec(0,0),width:1,height:4,points:[i.V.vec(0,0),i.V.vec(0,-1),i.V.vec(0,-2),i.V.vec(0,-3)]},{name:"O",pos:i.V.vec(0,0),width:2,height:2,points:[i.V.vec(0,0),i.V.vec(1,0),i.V.vec(0,-1),i.V.vec(1,-1)]}];function a(e){return e.next().value}function l(e,t){return{...e,pos:i.V.add(e.pos,t)}}function f(e,t,n){let o=e;switch(t){case">":if(i.V.x(e.pos)+1+e.width>7)return e;o=l(e,i.V.vec(1,0));break;case"<":if(i.V.x(e.pos)-1<0)return e;o=l(e,i.V.vec(-1,0));break;default:throw new Error(`Unknown direction: ${t}`)}return o.points.some((e=>n.hasPos(i.V.add(o.pos,e))))?e:o}function u(e,t){const n=t+2+e.height;return l(e,i.V.vec(2,n))}function d(e){return l(e,i.V.vec(0,-1))}function v(e,t,n){const o=i.V.y(e.pos)-e.height+1;if(o>n)return!1;if(0===o)return!0;const c=l(e,i.V.vec(0,-1));return c.points.some((e=>t.hasPos(i.V.add(c.pos,e))))}function h(e,t,n){for(const n of e.points)t.set(i.V.add(e.pos,n),e.name);return Math.max(n,i.V.y(e.pos)+1)}function*p(e){const t=function*(){for(;;)for(const e of s)yield e}(),n=new(0,r.Map2d);let o=0,i=u(a(t),o),c=0;for(;;){let r=!0;for(let s of e)yield{height:o,placedRocks:c,cycleStart:r,map:n,rock:i},r=!1,i=f(i,s,n),v(i,n,o)?(o=h(i,n,o),i=u(a(t),o),c++):i=d(i)}}i=o("idVGl"),c=o("c04jy");const V=document.getElementById("canvas");if(!(V instanceof HTMLCanvasElement))throw new Error("no canvas");const m=V.getContext("2d");if(!m)throw new Error("no ctx");const w=64,g={"+":"#ff922b","-":"#51cf66",L:"#339af0",O:"#cc5de8",I:"#e03131",".":"white"};!function(e,t,n){const o=window.devicePixelRatio||1;e.canvas.width=t*o,e.canvas.height=n*o,e.canvas.style.width=`${t}px`,e.canvas.style.height=`${n}px`,e.scale(o,o)}(m,45,320);const y=document.getElementById("input-form");if(!(y instanceof HTMLFormElement))throw new Error("no form");const E=document.getElementById("pause");if(!(E instanceof HTMLButtonElement))throw new Error("no pause button");const x=document.getElementById("speed");if(!(x instanceof HTMLInputElement))throw new Error("no speed input");const b=y.elements.namedItem("input");b instanceof HTMLTextAreaElement&&(b.value=">>><<><>><<<>><>>><<<>>><<<><<<>><>><<>>"),y.addEventListener("submit",(function(e){e.preventDefault();!function(e,t){t.canvas.scrollIntoView({behavior:"smooth"}),cancelAnimationFrame(I),M();const n=p(e.trim());let o=0;function r(){const{value:e}=n.next();if(!e)return;t.fillStyle="#343a40",t.fillRect(0,0,t.canvas.width,t.canvas.height);const{map:c,rock:r,height:s}=e,a=s+5;a-o>w&&(o=a-w,console.log(o));const l=c.to2dArray({valToString:e=>e??".",topLeftPos:i.V.vec(0,o),botRightPos:i.V.vec(6,Math.max(a,w))}),f=1;for(let e=0;e<l.length;e++)for(let n=0;n<l[e].length;n++)t.fillStyle=g[l[e][n]],t.fillRect(5*(n+f),5*e,5,5);r.points.forEach((e=>{const[n,c]=i.V.add(e,r.pos);t.fillStyle=g[r.name],t.fillRect(5*(n+f),5*(c-o),5,5)}))}let s=0;function a(e){if(L)s=0;else if(0===s)s=e,r();else if(e-s>T){const t=Math.floor((e-s)/T);s=e;for(const e of(0,c.range)(t))r()}I=requestAnimationFrame(a)}a(0)}((new FormData(this).get("input")?.toString()??"").trim(),m)})),E.addEventListener("click",(function(e){L?M():(L=!0,E&&(E.textContent="Play"))}));let L=!1;function M(){L=!1,E&&(E.removeAttribute("disabled"),E.textContent="Pause")}let T=500;x.value=String(1e3/T),x.addEventListener("input",(function(e){T=1e3/Number(this.value)}));let I=0;
//# sourceMappingURL=index.2f0064c3.js.map
